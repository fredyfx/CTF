from PySide.QtSvg import *
from PySide.QtGui import *
import sys, subprocess, urllib

def convertSvgToPng(svgFilepath,pngFilepath,width):
    r=QSvgRenderer(svgFilepath)
    height=r.defaultSize().height()*width/r.defaultSize().width()
    i=QImage(width,height,QImage.Format_ARGB32)
    p=QPainter(i)
    r.render(p)
    i.save(pngFilepath)
    p.end()

testfile = urllib.URLopener()
fileName = "entrance"

while(1):
	convertSvgToPng(fileName+".svg", fileName+".png", 490)   

	txt = subprocess.check_output(["zbarimg","-q", fileName+".png"]).strip()
	txt = txt.split(".svg")[0] + ".svg"
	link = txt.replace("QR-Code:", "")
	print txt.decode('utf-8')

	fileName = link.split("/")[1].replace(".svg", "")
	testfile.retrieve("http://"+link, fileName+".svg")
